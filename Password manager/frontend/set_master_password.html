<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <h1>Password Manager</h1>
        <form id="masterPasswordForm">
        <label for="masterPassword">Master Password</label>
        <input
            type="password"
            id="masterPassword"
            placeholder="Enter your master password"
            required
        />
        <label for="verifyPassword">Verify Password</label>
        <input
            type="password"
            id="verifyPassword"
            placeholder="Verify your master password"
            required
        />
        <button id="submit">Submit</button>
        </form>
        <p id="statusMessage" class="note"></p>
    </div>
    
    <script>
        let socket = null

        document.getElementById('submit').addEventListener('click', (event)=>
        {
            event.preventDefault();
        
            const masterPassword = document.getElementById('masterPassword').value;
            const verifyPassword = document.getElementById('verifyPassword').value;

            if(socket)
            {
                socket.close();
                socket = null;
            }

            socket = new WebSocket('ws://localhost:6789');
            
            socket.onopen = () => 
            {
                socket.send(masterPassword);
                socket.send(verifyPassword);
            };
        
            socket.onmessage = (event) => 
            {
                const message = event.data;
                    
                switch(message)
                {
                    case "Success!": 
                    {
                        socket.close();
                        window.location.href = "./enter_master.html";
                        break;
                    }
                    default:
                    {
                        alert("Passwords are invalid or not matching");
                        socket.close();
                        break;
                    }
                }
            };
    
        });
    </script>
      
</body>
</html>